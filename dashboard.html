<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keuangan PRM Bagong</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Open Sans', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-6 flex flex-col min-h-screen">
        <aside class="sidebar bg-blue-100 text-gray-800 w-64 p-4 rounded-md shadow-md mb-8">
            <div class="logo mb-6 text-center">
                <h2 class="text-blue-700 text-2xl font-semibold">PRM Bagong</h2>
            </div>
            <nav class="navigation">
                <ul class="list-none p-0">
                    <li class="mb-2">
                        <a href="#" class="active block px-4 py-2 rounded-md hover:bg-blue-200 transition duration-300">Dashboard</a>
                    </li>
                    <li class="mb-2">
                        <a href="dana_masuk.html" class="block px-4 py-2 rounded-md hover:bg-blue-200 transition duration-300">Dana Masuk</a>
                         <ul class="dropdown-content ml-4 mt-2 hidden">
                            <li><a href="input_dana_masuk.html" class="block px-4 py-2 rounded-md hover:bg-blue-200 transition duration-300">Input Dana Masuk</a></li>
                        </ul>
                    </li>
                    <li class="mb-2">
                        <a href="dana_keluar.html" class="block px-4 py-2 rounded-md hover:bg-blue-200 transition duration-300">Dana Keluar</a>
                        <ul class="dropdown-content ml-4 mt-2 hidden">
                            <li><a href="input_dana_keluar.html" class="block px-4 py-2 rounded-md hover:bg-blue-200 transition duration-300">Input Dana Keluar</a></li>
                        </ul>
                    </li>
                    <li class="mb-2">
                        <a href="laporan_saldo.html" class="block px-4 py-2 rounded-md hover:bg-blue-200 transition duration-300">Saldo</a>
                    </li>
                    <li class="mb-2">
                        <a href="laporan_keuangan.html" class="block px-4 py-2 rounded-md hover:bg-blue-200 transition duration-300">Laporan Keuangan</a>
                    </li>
                     <li class="mb-2">
                        <a href="pengaturan.html" class="block px-4 py-2 rounded-md hover:bg-blue-200 transition duration-300">Pengaturan</a>
                    </li>
                    <li class="mb-2">
                        <a href="logout.php" class="block px-4 py-2 rounded-md hover:bg-blue-200 transition duration-300">Logout</a>
                    </li>
                </ul>
            </nav>
        </aside>

        <main class="flex-1 p-6 rounded-md shadow-md bg-white">
            <header class="mb-8">
                <h1 class="text-3xl font-semibold text-gray-800">Dashboard</h1>
                <div class="user-info mt-2 text-gray-600">
                    Selamat datang, [Nama Pengguna]
                </div>
            </header>

            <section class="summary-cards grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <div class="card bg-white rounded-md shadow-sm p-4 text-center">
                    <h3 class="text-gray-700 text-lg mb-2">Saldo Saat Ini</h3>
                    <p class="saldo text-2xl text-blue-600 font-semibold" id="saldoSaatIni">Rp 0</p>
                </div>
                <div class="card bg-white rounded-md shadow-sm p-4 text-center">
                    <h3 class="text-gray-700 text-lg mb-2">Total Dana Masuk</h3>
                    <p class="masuk text-2xl text-green-600 font-semibold" id="totalDanaMasuk">Rp 0</p>
                </div>
                <div class="card bg-white rounded-md shadow-sm p-4 text-center">
                    <h3 class="text-gray-700 text-lg mb-2">Total Dana Keluar</h3>
                    <p class="keluar text-2xl text-red-600 font-semibold" id="totalDanaKeluar">Rp 0</p>
                </div>
            </section>

            <section class="recent-transactions bg-white rounded-md shadow-sm p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Transaksi Terakhir</h2>
                <div class="table-responsive">
                    <table class="min-w-full table-auto rounded-md overflow-hidden">
                        <thead class="bg-gray-200 text-gray-700">
                            <tr>
                                <th class="px-4 py-2 text-left">Tanggal</th>
                                <th class="px-4 py-2 text-left">Jenis</th>
                                <th class="px-4 py-2 text-left">Deskripsi</th>
                                <th class="px-4 py-2 text-right">Jumlah</th>
                            </tr>
                        </thead>
                        <tbody class="text-gray-600" id="daftarTransaksi">
                            <tr>
                                <td colspan="4" class="px-4 py-2 text-center text-gray-500">Belum ada transaksi.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
        });

        function loadDashboardData() {
            const saldoElement = document.getElementById('saldoSaatIni');
            const masukElement = document.getElementById('totalDanaMasuk');
            const keluarElement = document.getElementById('totalDanaKeluar');
            const transaksiList = document.getElementById('daftarTransaksi');

            const transaksiMasuk = JSON.parse(localStorage.getItem('danaMasuk') || '[]');
            const transaksiKeluar = JSON.parse(localStorage.getItem('danaKeluar') || '[]');
            let totalMasuk = 0;
            let totalKeluar = 0;

            transaksiMasuk.forEach(item => {
                totalMasuk += parseInt(item.jumlah);
            });

            transaksiKeluar.forEach(item => {
                totalKeluar += parseInt(item.jumlah);
            });

            const saldo = totalMasuk - totalKeluar;

            saldoElement.textContent = `Rp ${saldo.toLocaleString('id-ID')}`;
            masukElement.textContent = `Rp ${totalMasuk.toLocaleString('id-ID')}`;
            keluarElement.textContent = `Rp ${totalKeluar.toLocaleString('id-ID')}`;

            const semuaTransaksi = [...transaksiMasuk.map(t => ({ ...t, jenis: 'Masuk' })), ...transaksiKeluar.map(t => ({ ...t, jenis: 'Keluar' }))];
            semuaTransaksi.sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));

            transaksiList.innerHTML = '';

            if (semuaTransaksi.length > 0) {
                semuaTransaksi.forEach(transaksi => {
                    const row = transaksiList.insertRow();
                    const tanggalCell = row.insertCell();
                    const jenisCell = row.insertCell();
                    const deskripsiCell = row.insertCell();
                    const jumlahCell = row.insertCell();

                    tanggalCell.textContent = transaksi.tanggal;
                    jenisCell.textContent = transaksi.jenis;
                    deskripsiCell.textContent = transaksi.deskripsi || (transaksi.sumber || transaksi.tujuan);
                    jumlahCell.textContent = `Rp ${parseInt(transaksi.jumlah).toLocaleString('id-ID')}`;
                    jumlahCell.classList.add('text-right');
                });
            } else {
                const row = transaksiList.insertRow();
                const emptyCell = row.insertCell();
                emptyCell.colSpan = 4;
                emptyCell.textContent = 'Belum ada transaksi.';
                emptyCell.classList.add('text-center', 'text-gray-500');
            }
            // Tambahkan event listener untuk dropdown di sidebar
            const dropdownLinks = document.querySelectorAll('.navigation li.dropdown > a');
            dropdownLinks.forEach(link => {
                link.addEventListener('click', function(event) {
                    event.preventDefault(); // Mencegah link dari navigasi langsung
                    const dropdownContent = this.nextElementSibling; // Mendapatkan elemen dropdown-content terkait
                    if (dropdownContent.classList.contains('hidden')) {
                        dropdownContent.classList.remove('hidden'); // Menampilkan dropdown
                    } else {
                        dropdownContent.classList.add('hidden'); // Menyembunyikan dropdown
                    }
                });
            });
        }
    </script>
</body>
</html>
